{"version":3,"sources":["../../src/controllers/content.controller.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport CloudinaryService from '@/services/cloudinary.service';\r\nimport ContentService from '@/services/content.service';\r\nimport { Content } from '@/interfaces/content.interface';\r\nimport { HttpException } from '@/exceptions/HttpException';\r\nimport userModel from '@/models/users.model';\r\n\r\nclass ContentController {\r\n  public cloudinary = new CloudinaryService();\r\n  public contentService = new ContentService();\r\n  public users = userModel;\r\n\r\n  public uploadSingle = async (req: any, res: Response, next: NextFunction) => {\r\n    try {\r\n      const admin = await this.users.findOne({ _id: req.user._id });\r\n\r\n      if (!admin) throw new HttpException(404, 'Unauthorized');\r\n\r\n      if (admin.email !== 'sales@faithudo.com') throw new HttpException(404, 'Unauthorized');\r\n      const { video, thumbnail } = req.files;\r\n\r\n      const { savedVideo, savedThumb }: any = await this.cloudinary.uploadVideo(video[0], thumbnail[0]);\r\n\r\n      const content = await this.contentService.createContent({\r\n        video: savedVideo?.secure_url,\r\n        thumbnail: savedThumb?.secure_url,\r\n        title: req.body.title,\r\n        description: req.body.description,\r\n      });\r\n\r\n      res.status(200).json({ content });\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  public getAllContent = async (req: any, res: Response, next: NextFunction) => {\r\n    try {\r\n      const content = await this.contentService.getAllContent();\r\n\r\n      res.status(200).json({ content });\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n\r\n  public deleteContent = async (req: any, res: Response, next: NextFunction) => {\r\n    try {\r\n      const admin = await this.users.findOne({ _id: req.user._id });\r\n\r\n      if (!admin) throw new HttpException(404, 'Unauthorized');\r\n\r\n      if (admin.email !== 'sales@faithudo.com') throw new HttpException(404, 'Unauthorized');\r\n      const { id } = req.params;\r\n\r\n      const content = await this.contentService.deleteContent(id);\r\n\r\n      res.status(200).json({ content });\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n}\r\n\r\nexport default ContentController;\r\n"],"names":["ContentController","cloudinary","CloudinaryService","contentService","ContentService","users","userModel","uploadSingle","req","res","next","admin","findOne","_id","user","HttpException","email","video","thumbnail","files","savedVideo","savedThumb","uploadVideo","content","createContent","secure_url","title","body","description","status","json","error","getAllContent","deleteContent","id","params"],"mappings":"AAAA;;;;+BAgEA;;aAAA;;0DA/D8B;uDACH;+BAEG;mDACR;;;;;;AAEtB,IAAA,AAAMA,oBAAN,MAAMA;;aACGC,aAAa,IAAIC,0BAAiB;aAClCC,iBAAiB,IAAIC,uBAAc;aACnCC,QAAQC,mBAAS;aAEjBC,eAAe,OAAOC,KAAUC,KAAeC,OAAuB;YAC3E,IAAI;gBACF,MAAMC,QAAQ,MAAM,IAAI,CAACN,KAAK,CAACO,OAAO,CAAC;oBAAEC,KAAKL,IAAIM,IAAI,CAACD,GAAG;gBAAC;gBAE3D,IAAI,CAACF,OAAO,MAAM,IAAII,4BAAa,CAAC,KAAK,gBAAgB;gBAEzD,IAAIJ,MAAMK,KAAK,KAAK,sBAAsB,MAAM,IAAID,4BAAa,CAAC,KAAK,gBAAgB;gBACvF,MAAM,EAAEE,MAAK,EAAEC,UAAS,EAAE,GAAGV,IAAIW,KAAK;gBAEtC,MAAM,EAAEC,WAAU,EAAEC,WAAU,EAAE,GAAQ,MAAM,IAAI,CAACpB,UAAU,CAACqB,WAAW,CAACL,KAAK,CAAC,EAAE,EAAEC,SAAS,CAAC,EAAE;gBAEhG,MAAMK,UAAU,MAAM,IAAI,CAACpB,cAAc,CAACqB,aAAa,CAAC;oBACtDP,OAAOG,uBAAAA,wBAAAA,KAAAA,IAAAA,WAAYK,UAAU;oBAC7BP,WAAWG,uBAAAA,wBAAAA,KAAAA,IAAAA,WAAYI,UAAU;oBACjCC,OAAOlB,IAAImB,IAAI,CAACD,KAAK;oBACrBE,aAAapB,IAAImB,IAAI,CAACC,WAAW;gBACnC;gBAEAnB,IAAIoB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEP;gBAAQ;YACjC,EAAE,OAAOQ,OAAO;gBACdrB,KAAKqB;YACP;QACF;aAEOC,gBAAgB,OAAOxB,KAAUC,KAAeC,OAAuB;YAC5E,IAAI;gBACF,MAAMa,UAAU,MAAM,IAAI,CAACpB,cAAc,CAAC6B,aAAa;gBAEvDvB,IAAIoB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEP;gBAAQ;YACjC,EAAE,OAAOQ,OAAO;gBACdrB,KAAKqB;YACP;QACF;aAEOE,gBAAgB,OAAOzB,KAAUC,KAAeC,OAAuB;YAC5E,IAAI;gBACF,MAAMC,QAAQ,MAAM,IAAI,CAACN,KAAK,CAACO,OAAO,CAAC;oBAAEC,KAAKL,IAAIM,IAAI,CAACD,GAAG;gBAAC;gBAE3D,IAAI,CAACF,OAAO,MAAM,IAAII,4BAAa,CAAC,KAAK,gBAAgB;gBAEzD,IAAIJ,MAAMK,KAAK,KAAK,sBAAsB,MAAM,IAAID,4BAAa,CAAC,KAAK,gBAAgB;gBACvF,MAAM,EAAEmB,GAAE,EAAE,GAAG1B,IAAI2B,MAAM;gBAEzB,MAAMZ,UAAU,MAAM,IAAI,CAACpB,cAAc,CAAC8B,aAAa,CAACC;gBAExDzB,IAAIoB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEP;gBAAQ;YACjC,EAAE,OAAOQ,OAAO;gBACdrB,KAAKqB;YACP;QACF;;AACF;MAEA,WAAe/B"}