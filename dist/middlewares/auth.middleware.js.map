{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport { verify } from 'jsonwebtoken';\r\nimport { SECRET_KEY } from '@config';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\r\nimport userModel from '@models/users.model';\r\n\r\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\r\n  try {\r\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\r\n\r\n    if (Authorization) {\r\n      const secretKey: string = SECRET_KEY;\r\n      const verificationResponse = (await verify(Authorization, secretKey)) as DataStoredInToken;\r\n      const userId = verificationResponse._id;\r\n      const findUser = await userModel.findById(userId);\r\n\r\n      if (findUser) {\r\n        req.user = findUser;\r\n        next();\r\n      } else {\r\n        next(new HttpException(401, 'Wrong authentication token', {}));\r\n      }\r\n    } else {\r\n      next(new HttpException(404, 'Authentication token missing', {}));\r\n    }\r\n  } catch (error) {\r\n    next(new HttpException(401, 'Wrong authentication token', {}));\r\n  }\r\n};\r\n\r\nexport default authMiddleware;\r\n"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","secretKey","SECRET_KEY","verificationResponse","verify","userId","_id","findUser","userModel","findById","user","HttpException","error"],"mappings":"AAAA;;;;+BA+BA;;aAAA;;8BA9BuB;wBACI;+BACG;mDAER;;;;;;AAEtB,MAAMA,iBAAiB,OAAOC,KAAsBC,KAAeC,OAAuB;IACxF,IAAI;QACF,MAAMC,gBAAgBH,IAAII,OAAO,CAAC,gBAAgB,IAAKJ,CAAAA,IAAIK,MAAM,CAAC,mBAAmBL,IAAIK,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,IAAI,AAAD;QAE1I,IAAIH,eAAe;YACjB,MAAMI,YAAoBC,kBAAU;YACpC,MAAMC,uBAAwB,MAAMC,IAAAA,oBAAM,EAACP,eAAeI;YAC1D,MAAMI,SAASF,qBAAqBG,GAAG;YACvC,MAAMC,WAAW,MAAMC,mBAAS,CAACC,QAAQ,CAACJ;YAE1C,IAAIE,UAAU;gBACZb,IAAIgB,IAAI,GAAGH;gBACXX;YACF,OAAO;gBACLA,KAAK,IAAIe,4BAAa,CAAC,KAAK,8BAA8B,CAAC;YAC7D,CAAC;QACH,OAAO;YACLf,KAAK,IAAIe,4BAAa,CAAC,KAAK,gCAAgC,CAAC;QAC/D,CAAC;IACH,EAAE,OAAOC,OAAO;QACdhB,KAAK,IAAIe,4BAAa,CAAC,KAAK,8BAA8B,CAAC;IAC7D;AACF;MAEA,WAAelB"}