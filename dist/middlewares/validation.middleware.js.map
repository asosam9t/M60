{"version":3,"sources":["../../src/middlewares/validation.middleware.ts"],"sourcesContent":["import { plainToClass } from 'class-transformer';\r\nimport { validate, ValidationError } from 'class-validator';\r\nimport { RequestHandler } from 'express';\r\nimport { HttpException } from '@exceptions/HttpException';\r\n\r\nconst validationMiddleware = (\r\n  type: any,\r\n  value: string | 'body' | 'query' | 'params' = 'body',\r\n  skipMissingProperties = false,\r\n  whitelist = true,\r\n  forbidNonWhitelisted = true,\r\n): RequestHandler => {\r\n  return (req, res, next) => {\r\n    validate(plainToClass(type, req[value]), { skipMissingProperties, whitelist, forbidNonWhitelisted }).then((errors: ValidationError[]) => {\r\n      if (errors.length > 0) {\r\n        const derrors = {};\r\n        errors.map((error: ValidationError) => {\r\n          const message = Object.values(error.constraints);\r\n          const label = error.property;\r\n          derrors[label] = message[0];\r\n        });\r\n\r\n        next(new HttpException(400, 'Invalid input', derrors));\r\n      } else {\r\n        next();\r\n      }\r\n    });\r\n  };\r\n};\r\n\r\nexport default validationMiddleware;\r\n"],"names":["validationMiddleware","type","value","skipMissingProperties","whitelist","forbidNonWhitelisted","req","res","next","validate","plainToClass","then","errors","length","derrors","map","error","message","Object","values","constraints","label","property","HttpException"],"mappings":"AAAA;;;;+BA8BA;;aAAA;;kCA9B6B;gCACa;+BAEZ;AAE9B,MAAMA,uBAAuB,CAC3BC,MACAC,QAA8C,MAAM,EACpDC,wBAAwB,KAAK,EAC7BC,YAAY,IAAI,EAChBC,uBAAuB,IAAI,GACR;IACnB,OAAO,CAACC,KAAKC,KAAKC,OAAS;QACzBC,IAAAA,wBAAQ,EAACC,IAAAA,8BAAY,EAACT,MAAMK,GAAG,CAACJ,MAAM,GAAG;YAAEC;YAAuBC;YAAWC;QAAqB,GAAGM,IAAI,CAAC,CAACC,SAA8B;YACvI,IAAIA,OAAOC,MAAM,GAAG,GAAG;gBACrB,MAAMC,UAAU,CAAC;gBACjBF,OAAOG,GAAG,CAAC,CAACC,QAA2B;oBACrC,MAAMC,UAAUC,OAAOC,MAAM,CAACH,MAAMI,WAAW;oBAC/C,MAAMC,QAAQL,MAAMM,QAAQ;oBAC5BR,OAAO,CAACO,MAAM,GAAGJ,OAAO,CAAC,EAAE;gBAC7B;gBAEAT,KAAK,IAAIe,4BAAa,CAAC,KAAK,iBAAiBT;YAC/C,OAAO;gBACLN;YACF,CAAC;QACH;IACF;AACF;MAEA,WAAeR"}